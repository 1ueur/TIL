## 매크로프로세서 설계
### 패스 1
- **매크로 정의 인식** : ```MACRO```와 ```ENDM```으로 구별되는 **매크로 정의 부분을 인식**
    - 매크로 프로세서는 **지시어 ```MACRO```와 ```ENDM```**에 의해 구별되는 매크로 정의를 인식해야 한다.
    - 매크로 내의 매크로 정의가 나타나는 경우
      - 매크로 프로세서가 여러 개의 ```MACRO```와 ```ENDM```가 중첩된 사실을 인식하여 **처음의```MACRO```와 마지막```ENDM```을 정확하게 일치**시켜야 한다.


- **매크로 정의 저장** : 명령어 확장을 위해 참고할 **매크로 정의를 저장**
  - 매크로 프로세서는 매크로 호출 시 대응하는 일련의 명령어를 확장하기 위하여 참고할 **정의를 내부에 저장**해두어야 한다.

### 패스 2
- **매크로 호출 인식** : 프로그램 중의 **매크로 호출 부분을 인식**
  - 매크로 프로세서는 니모닉 명령어의 형식으로 나타나는 **매크로 호출을 인식**해야 한다.
  - 이를 위해서 **매크로 이름을 테이블에 따로 저장**하여 연산 코드의 일종으로 다루어야 한다.


- **매크로 확장과 인수 치환** : 형식 인수를 실 인수로 대체하여 **매크로를 확장**
  - 매크로 프로세서는 **호출 시에 형식 인수에 대응하는 실 인수 값으로 치환**해주어야 한다.

<br/>

## 매크로 프로세서의 자료구조
매크로 프로세서는 입력 문장(원시 소스코드)을 두 번의 패스에 걸쳐 2회 검색한다.
- **패스 1** : 매크로 정의 부분을 찾아 정의 내용을 저장한다.
  - 프로그램 내의 모든 명령어를 조사하여 매크로 정의 부분을 빠짐없이 **매크로 정의표(MDT)** 내에 저장한다. 👉🏻 패스 2에게 넘겨 준다.
  - 매크로 정의표에 따라 **매크로 이름표(MNT)** 도 이때 작성한다. 👉🏻 패스 2에게 넘겨 준다.


- **패스 2** : 매크로 호출을 찾는다.
  - 모든 코드를 검색하면서 매크로 이름 형식으로 쓰여진 각 **매크로 호출을 매크로 이름표(MNT)와 매크로 정의표(MDT)를 조사**, **참조하여 적당한 명령어 블록의 치환**

### 패스 1의 자료구조
a. 입력된 원시 프로그램 <br/>

b. 매크로 정의표(MDT) <br/>

c. 매크로 정의표 계수기(MDTC) <br/> &nbsp; MDT 내의 행 번호 지정을 위한 변수 <br/>

d. 매크로 이름표(MNT) <br/>

e. 매크로 이름표 계수기(MNTC) <br/> &nbsp; MNT 내의 행 번호 지정을 위한 변수 <br/>

f. 형식 인수 표 <br/> &nbsp; 매크로 정의를 저장하기 전에 형식 인수를 색인 표시로 치환하기 위해 사용

### 패스 2의 자료구조
a. 원시 프로그램 <br/>

b. 매크로 정의표(MDT) - 패스 1에서 받아옴 <br/>

c. 매크로 이름표(MNT) - 패스 1에서 받아옴 <br/>

d. 매크로 정의표 포인터(MDTP) <br/> &nbsp; 매크로 확장 시에, 현재 확장되고 있는 MDT 내의 문장의 위치 지정을 위해 쓰이는 변수

e. 실 인수표 <br/> &nbsp; 저장된 매크로 정의 내의 색인 표시를 매크로 호출 시의 인수 값으로 치환하기 위하여 사용

